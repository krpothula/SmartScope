{% load static %}
<link rel="stylesheet" href="{% static 'dialogueform.css' %}">

{% if instance.targets_prefix == 'hole' %}
<li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="allHolesDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        All Holes 
    </a>
    <ul class="dropdown-menu" aria-labelledby="allHolesDropdown">
        <li>
            <button class="dropdown-item" onmousedown="queueSquareTargets(this)" value="addall">Queue all holes</button>
        </li>
        <li>
            <button class="dropdown-item" onmousedown="queueSquareTargets(this)" value="cancelall">Cancel all holes</button>
        </li>
        <li>
            <button id="regroupBIS" class="dropdown-item" onmousedown="regroupBIS('{{instance.pk}}')">Regroup BIS</button>
        </li>
        <li>
            <button id="deleteHoles" class="dropdown-item" onmousedown="deleteHoles('{{instance.pk}}')">Delete Holes</button>
        </li>
        <li class="dropdown-submenu">
            <a class="dropdown-item dropdown-toggle" href="#" id="extendLatticeDropdown" data-instance-pk="{{ instance.pk }}" data-grid-id="{{ instance.grid_id.pk }}">
                Extend Lattice <span class="submenu-arrow">&#9656;</span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="extendLatticeDropdown">
                <li>
                    <button class="dropdown-item" onmousedown="extendLattice('{{instance.pk}}')">Default</button>
                </li>
                <li>
                    <button class="dropdown-item" onmousedown="openExtendLatticeForm('{{ instance.pk }}', '{{ instance.grid_id.pk }}')">Interactive</button>
                </li>
            </ul>
        </li>
    </ul>
</li>

<li class="nav-item dropdown" data-bs-toggle="tooltip" title="Hold Shift+click to start adding new targets on the image">
    <a class="nav-link dropdown-toggle disabled" href="#" id="addTargetsBtn" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        New targets 
    </a>
    <ul class="dropdown-menu">
        <li>
            <button id="addTargets" class="dropdown-item" onclick="addTargets(this, targetsSelection)">Add Targets</button>
        </li>
        <li>
            <button id="clearTargets" class="dropdown-item" onclick="clearSelection(targetsSelection, 'targets')">Clear Targets</button>
        </li>
    </ul>
</li>
{% else %}
<li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="allHolesDropdownElse" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        All Holes
    </a>
    <ul class="dropdown-menu" aria-labelledby="allHolesDropdownElse">
        <li>
            <button id="regroupBIS" class="dropdown-item" onclick="regroupBIS('{{instance.grid_id.pk}}', getRegroupBISallUrl)">Regroup BIS</button>
        </li>
    </ul>
</li>
{% endif %}

<!-- Hidden Form -->
<div id="dialogueForm" class="dialogue-form">
    <h5>Extend Lattice Parameters</h5>
    <form id="extendLatticeForm"">
        <div class="form-group row">
            <label for="squareMeshSpacing" class="col-4 col-form-label">Square Mesh Spacing</label>
            <div class="col-8">
                <input type="number" class="form-control" id="squareMeshSpacing" name="square_mesh_spacing" step="0.01">
            </div>
        </div>
        <div class="form-group row">
            <label for="squareMeshRotation" class="col-4 col-form-label">Square Mesh Rotation</label>
            <div class="col-8">
                <input type="number" class="form-control" id="squareMeshRotation" name="square_mesh_rotation" step="0.01">
            </div>
        </div>
        <div class="form-group row">
            <label for="holeSquareSpacing" class="col-4 col-form-label">Hole Square Spacing</label>
            <div class="col-8">
                <input type="number" class="form-control" id="holeSquareSpacing" name="hole_square_spacing" step="0.01" required>
            </div>
        </div>
        <div class="form-group row">
            <label for="holeSquareRotation" class="col-4 col-form-label">Hole Square Rotation</label>
            <div class="col-8">
                <input type="number" class="form-control" id="holeSquareRotation" name="hole_square_rotation" step="0.01" required>
            </div>
        </div>
        <div class="form-group row">
            <label for="holeMedmagSpacing" class="col-4 col-form-label">Hole MedMag Spacing</label>
            <div class="col-8">
                <input type="number" class="form-control" id="holeMedmagSpacing" name="hole_medmag_spacing" step="0.01">
            </div>
        </div>
        <div class="form-group row">
            <label for="holeMedmagRotation" class="col-4 col-form-label">Hole MedMag Rotation</label>
            <div class="col-8">
                <input type="number" class="form-control" id="holeMedmagRotation" name="hole_medmag_rotation" step="0.01">
            </div>
        </div>
        <div class="d-flex justify-content-end mt-4">
            <button type="button" class="btn btn-secondary me-2" onclick="closeExtendLatticeForm()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="submitExtendLatticeForm()">Submit</button>
        </div>
    </form>
</div>

<!-- Background Overlay -->
<div id="dialogueOverlay" class="dialogue-overlay" onclick="closeExtendLatticeForm()"></div>

                              
